# Releasing

This project uses tag-driven releases with GitHub Actions, GitHub Releases, and PyPI trusted publishing.

## Why this is standard

This release approach follows current Python packaging best practices:

- `pyproject.toml` + build backend is the modern standard for packaging
- wheel + source distribution are standard publish artifacts
- CI checks before publish reduce broken releases
- tag-driven releases make version history clear and repeatable
- PyPI trusted publishing (OIDC) avoids long-lived API tokens and improves security

In short: this flow is not over-engineered; it is a clean, common setup for reliable Python library releases.

## One-time setup

1. In PyPI, create the project if it does not exist.
2. In PyPI project settings, configure a trusted publisher for this repository.
3. In GitHub, create an environment named `pypi`.
4. Optionally add required reviewers for the `pypi` environment.

## Release steps

1. Ensure local quality checks are green:

   ```bash
   make check
   ```

2. Bump version in `pyproject.toml`.
3. Update `CHANGELOG.md`.
4. Commit changes:

   ```bash
   git add .
   git commit -m "release: vX.Y.Z"
   ```

5. Create and push tag:

   ```bash
   git tag vX.Y.Z
   git push origin vX.Y.Z
   ```

6. GitHub workflow `.github/workflows/release.yml` will:
   - lint, type-check, and test
   - build wheel and source distribution
   - validate package metadata
   - publish to PyPI from tag builds

7. GitHub workflow `.github/workflows/github-release.yml` will:
   - build wheel and source distribution
   - create signed build provenance attestations for release artifacts
   - create a GitHub Release with autogenerated notes
   - upload built distributions to the Release page

## Dry-run option

Use workflow_dispatch to run build and validation without publishing (no tag required).

## Release notes

GitHub Release notes are autogenerated from merged PRs and commits. Keep `CHANGELOG.md`
updated for human-curated release summaries.

## Rollback guidance

- If publish fails before upload, fix and re-run workflow.
- If publish succeeds with incorrect package metadata, release a new patch version.
- Avoid deleting published versions from PyPI unless absolutely necessary.
